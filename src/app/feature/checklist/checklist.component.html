<section class="checklist md:container sm:p-1 textColor mr-8">
    <p-toast styleClass="text-xl topclass"></p-toast>
    <div class="flex justify-content-between realwidth border-bottom-1 p-2 border-500">
        <div class="flex align-items-center gap-5">
            <h3>My Tasks</h3><i class="pi pi-sort-alt p-3 border-round-xl cursor-pointer hover:bg-gray-300"
                (click)="sortTaskData()"></i>
        </div>
        <div class="flex align-items-center gap-3">
            <!-- <i class="pi pi-angle-left text-2xl p-2 border-circle hover:bg-gray-400" ></i> -->
            <i class="pi pi-calendar text-3xl"></i>
            <p-calendar [(ngModel)]="formatedDate" [defaultDate]="defaultDate" dateFormat="dd/m/yy"
                styleClass="text-2xl" panelStyleClass="panel-left custom-calendar"></p-calendar>
            <!-- <i class="pi pi-angle-right text-2xl p-2 border-circle hover:bg-gray-400"></i> -->

        </div>
    </div>
    <p-dialog header="View Task Details" [(visible)]="displayModal" [modal]="true"  [style]="{width: '40vw'}" [baseZIndex]="10000"
        [draggable]="false" [resizable]="false" >
        <div *ngFor="let tasks of todaysTask">
        <ng-container *ngIf="tasks.id==modalClickedId">
        <label class="text-3xl font-bold">Task</label>
        <p class="text-2xl" >{{tasks.heading}}</p>
        <label class="text-3xl font-bold">Description</label>
        <p class="text-2xl">{{tasks.desc}}</p>
    </ng-container>
    </div>
    </p-dialog>
    <div class="card">
        <p-table [value]="todaysTask" dataKey="id" editMode="row" [reorderableColumns]="true" [loading]="loading"  >
            <ng-template pTemplate="body" let-tasks let-editing="editing" let-ri="rowIndex">
                <tr [pReorderableRow]="ri" class=" flex align-items-center hover:bg-gray-200"
                    (click)="openSubtasksbar(tasks.id)"
                    *ngIf="tasks.date==formatedDate.toLocaleString().split(',').splice(0,1)[0]" [pEditableRow]="tasks">
                    <div class=" w-3rem h-3rem flex align-items-center justify-content-center border-round-xl mr-2">
                        <p-confirmPopup></p-confirmPopup>
                        <ng-container *ngIf="!tasks.completed; else checked">
                            <i class="pi pi-circle text-2xl" (click)="markItComplete(tasks)"></i>
                          </ng-container>
                        
                        <ng-template #checked>
                            <i class="pi pi-check-circle text-2xl" (click)="markItComplete(tasks)"></i>
                        </ng-template>
                    </div>
                    <td class="text-2xl border-0 siztex cursor-move" [pReorderableRowHandle] (click)="showModalDialog(tasks.id)">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <input pInputText type="text" class="w-full text-2xl" [(ngModel)]="tasks.heading"
                                    maxlength="150">
                            </ng-template>
                            <ng-template pTemplate="output" >
                               <div [ngClass]="{'line-through': tasks.completed}">
                                {{tasks.heading|slice:0:80}}<span *ngIf="tasks.heading.length>77">...</span>
                               </div> 
                            </ng-template>
                        </p-cellEditor>
                    
                    </td>
                    <!-- <div class="bg-green-100 flex align-items-center cursor-pointer border-green-500 border-round-2xl border-1 text-2xl px-2 text-green-900 hover:bg-green-300 " (click)="openSubtasksbar(tasks.id)">View Details
                            </div> -->
                    <td class="border-0">
                        <div class="flex align-items-center justify-content-center gap-2">
                            <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow icon="pi pi-pencil"
                                (click)="onRowEditInit(tasks)" class="p-button-rounded p-button-text"></button>
                            <button *ngIf="editing" pButton pRipple type="button" pSaveEditableRow icon="pi pi-check"
                                (click)="onRowEditSave(tasks)"
                                class="p-button-rounded p-button-text p-button-success mr-2"></button>
                            <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow icon="pi pi-times"
                                (click)="onRowEditCancel(tasks, ri)"
                                class="p-button-rounded p-button-text p-button-danger"></button>
                        </div>
                    </td>
                    <i class="pi pi-trash text-2xl" class="hidden hover:block" (click)="confirm($event,tasks.id)"></i>
                </tr>
            </ng-template>
        </p-table>
    </div>


    <div class="border-1 border-round-xl p-3 mt-3" *ngIf="addlistvalue">
        <div class="flex justify-content-between gap-1">
            <input pInputText type="text" name="" id="" class="max-w-full w-full border-0 text-2xl mb-2"
                placeholder="Task Name" [(ngModel)]="newTaskName" maxlength="300">
            <i class="pi pi-times border-circle cursor-pointer p-1" pTooltip="Close" tooltipPosition="top"
                (click)="addlistvalue=false"></i>
        </div>

        <input pInputText type="text" name="" id="" class="w-full border-0 text-xl" placeholder="Description"
            [(ngModel)]="newTaskdescription" maxlength="1000">
        <div class="flex justify-content-between mt-3 border-top-1 pt-3 border-gray-300">
            <div class="flex align-items-center p-2">
                <label class="text-2xl mr-2 text-gray-700"><i class="pi pi-flag"></i> Priority - </label>
                <p-rating [(ngModel)]="priority" [cancel]="false" [stars]="3" class="mr-4" ></p-rating> <ng-container *ngIf="priority==3"><span class="text-gray-600">High Priority</span></ng-container>
            </div>
            <button pButton class="text-2xl p-0 h-3rem px-3 bg-green-800" (click)="addnewtask()">Save</button>
        </div>
    </div>


    <div class="flex mt-5 gap-2 align-items-center onhoverbtn mb-2 px-1 " (click)="addlist()">
        <i class="pi pi-plus text-xl onhovericon  border-1 border-white p-1 cursor-pointer"></i>
        <label class="text-xl cursor-pointer ">Add Task</label>
    </div>
</section>